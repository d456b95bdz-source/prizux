<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prizux | Login</title>
  <style>
    :root{
      --bg:#0b0d12; --card:rgba(255,255,255,.08); --line:rgba(255,255,255,.14);
      --text:#f5f7fb; --muted:#b9c0cf; --pri:#7fb3ff; --pri2:#5f9dff; --danger:#ff8d8d; --ok:#9df2b8;
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:grid; place-items:center; color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Noto Sans KR",sans-serif;
      background:
        radial-gradient(1000px 500px at 10% -10%,rgba(127,179,255,.25),transparent 55%),
        radial-gradient(900px 500px at 100% 100%,rgba(140,120,255,.22),transparent 55%),
        var(--bg);
      padding:24px;
    }
    .wrap{
      width:min(560px, 94vw);
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      backdrop-filter:blur(14px);
      border-radius:var(--radius);
      padding:26px;
      box-shadow:0 30px 70px rgba(0,0,0,.45);
    }
    h1{margin:0 0 6px; font-size:1.7rem; letter-spacing:-.02em}
    p.sub{margin:0 0 18px; color:var(--muted); line-height:1.6}
    .row{display:grid; gap:8px; margin-bottom:12px}
    label{font-size:.9rem; color:#d8dff0}
    input{
      width:100%; border:1px solid var(--line); border-radius:12px;
      background:rgba(255,255,255,.04); color:var(--text);
      padding:12px 13px; font-size:.95rem; outline:none;
    }
    input:focus{border-color:rgba(127,179,255,.8); box-shadow:0 0 0 3px rgba(127,179,255,.15)}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    button, a.btn{
      border:1px solid var(--line); background:rgba(255,255,255,.06); color:var(--text);
      padding:11px 14px; border-radius:999px; cursor:pointer; text-decoration:none; font-size:.92rem;
    }
    button.primary{background:linear-gradient(135deg, rgba(95,157,255,.35), rgba(95,157,255,.14)); border-color:rgba(127,179,255,.7)}
    .msg{min-height:24px; margin-top:10px; font-size:.92rem; color:var(--muted)}
    .err{color:var(--danger)} .ok{color:var(--ok)}
    .forgot{margin-top:12px; padding-top:12px; border-top:1px dashed var(--line)}
    .forgot-panel{display:none; margin-top:10px}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Sign in</h1>
    <p class="sub">이메일, 아이디, 비밀번호를 모두 확인합니다.</p>

    <form id="loginForm" autocomplete="off">
      <div class="row"><label>Email</label><input id="email" type="email" required /></div>
      <div class="row"><label>ID</label><input id="username" type="text" required /></div>
      <div class="row"><label>Password</label><input id="password" type="password" required /></div>
      <div class="btns">
        <button class="primary" type="submit">로그인</button>
        <a class="btn" href="/signup">회원가입</a>
      </div>
    </form>

    <div class="forgot">
      <button id="forgotBtn" type="button">I forgot something</button>

      <section class="forgot-panel" id="forgotPanel">
        <div class="row">
          <label>가입한 이메일</label>
          <input id="forgotEmail" type="email" />
        </div>
        <div class="btns">
          <button id="sendForgotCodeBtn" type="button" class="primary">인증코드 보내기</button>
        </div>

        <div class="row" style="margin-top:10px;">
          <label>8-digit code</label>
          <input id="forgotCode" type="text" maxlength="8" inputmode="numeric" />
        </div>
        <div class="row">
          <label>새 비밀번호</label>
          <input id="newPassword" type="password" minlength="8" />
        </div>
        <div class="btns">
          <button id="verifyForgotBtn" type="button">코드 확인 후 재설정</button>
          <button id="resendForgotBtn" type="button">코드 재전송</button>
        </div>
      </section>
    </div>

    <div id="msg" class="msg"></div>
  </main>

  <script>
    const msg = document.getElementById('msg');
    const loginForm = document.getElementById('loginForm');
    const forgotBtn = document.getElementById('forgotBtn');
    const forgotPanel = document.getElementById('forgotPanel');

    function setMsg(t, type='') {
      msg.className = 'msg ' + (type || '');
      msg.textContent = t;
    }

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      setMsg('처리 중...');
      const res = await fetch('/api/v1/auth/login', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          email: document.getElementById('email').value.trim(),
          username: document.getElementById('username').value.trim(),
          password: document.getElementById('password').value
        })
      });
      const data = await res.json().catch(()=>({}));
      if (res.ok) {
        setMsg('로그인 성공', 'ok');
        setTimeout(()=>location.href='/', 600);
      } else {
        // 요구사항: 하나라도 틀리면 "something is wrong"
        setMsg('something is wrong', 'err');
      }
    });

    forgotBtn.addEventListener('click', () => {
      forgotPanel.style.display = forgotPanel.style.display === 'block' ? 'none' : 'block';
    });

    async function sendForgotCode() {
      const email = document.getElementById('forgotEmail').value.trim();
      const res = await fetch('/api/v1/auth/forgot/send-code', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email })
      });
      const data = await res.json().catch(()=>({}));
      if (res.ok) setMsg(data.message || '인증코드 전송 완료', 'ok');
      else setMsg(data.detail || '요청 실패', 'err');
    }

    document.getElementById('sendForgotCodeBtn').addEventListener('click', sendForgotCode);
    document.getElementById('resendForgotBtn').addEventListener('click', sendForgotCode);

    document.getElementById('verifyForgotBtn').addEventListener('click', async () => {
      const res = await fetch('/api/v1/auth/forgot/verify-reset', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          email: document.getElementById('forgotEmail').value.trim(),
          code: document.getElementById('forgotCode').value.trim(),
          new_password: document.getElementById('newPassword').value
        })
      });
      const data = await res.json().catch(()=>({}));
      if (res.ok) setMsg('재설정 성공. 이제 새 비밀번호로 로그인하세요.', 'ok');
      else setMsg(data.detail || '인증 실패', 'err');
    });
  </script>
</body>
</html>
